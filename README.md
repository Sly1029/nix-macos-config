Heavily altered from https://github.com/dustinlyons/nixos-config
